[workspace]
name = "iris-mlops"
version = "0.1.0"
description = "Iris classification/regression with MLOps workflow scaffold"
channels = ["conda-forge"]
platforms = ["osx-64", "osx-arm64", "linux-64"]

[dependencies]
python = "3.12.*"
numpy = "==1.26.4"
pandas = "==2.2.3"
tabulate = "==0.9.0"
scikit-learn = "==1.5.2"
pyyaml = "==6.0.2"
matplotlib = "==3.10.1"
mlflow = "==2.16.0"
wandb = "==0.23.1"
black = "==24.10.0"
isort = "==5.13.2"
ruff = "==0.8.1"
mypy = "==1.13.0"
bandit = "==1.7.9"
pre-commit = "==3.8.0"
dvc = "==3.64.0"
sqlite = "3.48.*"
hydra-core = "==1.3.2"
apache-airflow = "==2.9.3"
clearml = "==2.0.2"
mkdocs = "==1.6.1"
mkdocs-material = "==9.7.1"
pymdown-extensions = "==10.19.1"
flask-limiter = "==3.12"

[tasks]
fmt = "ruff format . && black . && isort ."
lint = "ruff check ."
types = "mypy ."
security = "bandit -c bandit.yaml -r src"
qa = "pre-commit run --all-files"
train = "python scripts/train_model.py"
list-models = "python scripts/list_models.py"
dvc-repro-get-data = "dvc repro get_data"
wandb-experiments = "python scripts/wandb_experiments.py"
wandb-query = "python scripts/wandb_query_runs.py"
hw4-run-local = "python scripts/hw4_get_data.py && python scripts/hw4_prepare.py && python scripts/hw4_train.py model=logreg && python scripts/hw4_train.py model=rf && python scripts/hw4_train.py model=svc && python scripts/hw4_select_best.py && python scripts/hw4_notify.py"
hw4-screenshots = "python scripts/hw4_generate_screenshots.py"
airflow-init = "AIRFLOW_HOME=$PWD/.airflow AIRFLOW__CORE__DAGS_FOLDER=$PWD/airflow/dags AIRFLOW__CORE__LOAD_EXAMPLES=False airflow db init"
airflow-test-hw4 = "AIRFLOW_HOME=$PWD/.airflow AIRFLOW__CORE__DAGS_FOLDER=$PWD/airflow/dags AIRFLOW__CORE__LOAD_EXAMPLES=False airflow dags test iris_hw4_pipeline 2024-01-01"
# Airflow UI defaults to 8080, but ClearML uses 8080 too. Use 8082 to avoid conflicts.
airflow-standalone = "AIRFLOW_HOME=$PWD/.airflow AIRFLOW__CORE__DAGS_FOLDER=$PWD/airflow/dags AIRFLOW__CORE__LOAD_EXAMPLES=False AIRFLOW__WEBSERVER__WEB_SERVER_PORT=8082 airflow standalone"
hw5-smoke = "python scripts/hw5_clearml_smoke.py"
hw5-experiments = "python scripts/hw5_clearml_experiments.py"
hw5-compare = "python scripts/hw5_clearml_compare.py"
hw5-list-models = "python scripts/hw5_clearml_list_models.py"
hw5-pipeline = "python scripts/hw5_clearml_pipeline.py --run-locally"
hw5-screenshots = "python scripts/hw5_generate_screenshots.py"
hw5-scheduler = "python scripts/hw5_clearml_scheduler.py --run-once"
hw5-scheduler-hourly = "python scripts/hw5_clearml_scheduler.py --every-minutes 60 --execute-immediately"
docs-build = "python scripts/hw6_generate_docs.py && mkdocs build -f mkdocs.yml"
docs-serve = "python scripts/hw6_generate_docs.py && mkdocs serve -f mkdocs.yml"
